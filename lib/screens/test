// import 'package:flutter/material.dart';
// import '../models/class.dart';
// import '../models/student.dart';
// import '../services/class_service.dart';
// import '../services/attendance_service.dart';
// import '../services/student_service.dart';

// class AttendanceScreen extends StatefulWidget {
//   @override
//   _AttendanceScreenState createState() => _AttendanceScreenState();
// }


// class _AttendanceScreenState extends State<AttendanceScreen> {
//   final ClassService _classService = ClassService();
//   final StudentService _studentService = StudentService();
//   final AttendanceService _attendanceService = AttendanceService();

//   List<ClassModel> _classes = [];
//   List<StudentModel> _students = [];
//   Map<String, bool> _attendance = {};
//   String? _selectedClass;
//   DateTime _selectedDate = DateTime.now();

//   @override
//   void initState() {
//     super.initState();
//     _loadClasses();
//   }

//   Future<void> _loadClasses() async {
//     final classes = await _classService.getClasses();
//     setState(() {
//       _classes = classes;
//     });
//   }

//   Future<void> _loadStudents() async {
//     if (_selectedClass != null) {
//       final students = await _studentService.getStudents(_selectedClass!);
//       setState(() {
//         _students = students;
//         _attendance = {for (var student in students) student.name: false};
//       });
//     }
//   }

//   void _submitAttendance() async {
//     await _attendanceService.submitAttendance(
//       _selectedClass!,
//       _selectedDate,
//       _attendance,
//     );
//     Navigator.pop(context);
//   }

//   @override
//   Widget build(BuildContext context) {
//     return Scaffold(
//       appBar: AppBar(
//         title: Text('Take Attendance'),
//       ),
//       body: Padding(
//         padding: const EdgeInsets.all(16.0),
//         child: Column(
//           children: [
//             DropdownButton<String>(
//               value: _selectedClass,
//               hint: Text('Select Class'),
//               onChanged: (value) {
//                 setState(() {
//                   _selectedClass = value;
//                   _loadStudents();
//                 });
//               },
//               items: _classes.map((classModel) {
//                 return DropdownMenuItem<String>(
//                   value: classModel.id,
//                   child: Text(classModel.name),
//                 );
//               }).toList(),
//             ),
//             TextField(
//               decoration: InputDecoration(labelText: 'Select Date'),
//               readOnly: true,
//               controller: TextEditingController(text: '${_selectedDate.toLocal()}'.split(' ')[0]),
//               onTap: () async {
//                 final date = await showDatePicker(
//                   context: context,
//                   initialDate: _selectedDate,
//                   firstDate: DateTime(2000),
//                   lastDate: DateTime(2101),
//                 );
//                 if (date != null && date != _selectedDate) {
//                   setState(() {
//                     _selectedDate = date;
//                   });
//                 }
//               },
//             ),
//             Expanded(
//               child: ListView(
//                 children: _students.map((student) {
//                   return CheckboxListTile(
//                     title: Text(student.name),
//                     value: _attendance[student.id],
//                     onChanged: (value) {
//                       setState(() {
//                         _attendance[student.id] = value ?? false;
//                       });
//                     },
//                   );
//                 }).toList(),
//               ),
//             ),
//             ElevatedButton(
//               onPressed: _submitAttendance,
//               child: Text('Submit Attendance'),
//             ),
//           ],
//         ),
//       ),
//     );
//   }
// }


// import 'package:cloud_firestore/cloud_firestore.dart';
// import '../models/attendance.dart';

// class AttendanceService {
//   final FirebaseFirestore _db = FirebaseFirestore.instance;

//   Future<void> submitAttendance(String className, DateTime date, Map<String, bool> studentAttendance) async {
//     await _db.collection('attendance').add({
//       'className': className,
//       'date': Timestamp.fromDate(date),
//       'studentAttendance': studentAttendance,
//     });
//   }

//   Future<List<AttendanceModel>> getAttendanceHistoryByClass(String className) async {
//     print('Attendance History initialized');
//     final snapshot = await _db
//         .collection('attendance')
//         .where('className', isEqualTo: className)
//         .orderBy('date', descending: true)
//         .get();
// print('Attendance History fetched');
// print(snapshot.docs.map((doc) => AttendanceModel.fromFirestore(doc)).toList());
//     return snapshot.docs.map((doc) => AttendanceModel.fromFirestore(doc)).toList();
//   }

  
// }



// import 'package:cloud_firestore/cloud_firestore.dart';

// class AttendanceModel {
//   final String id;
//   final String className;
//   final DateTime date;
//   final Map<String, bool> studentAttendance; // Map of student names to attendance status

//   AttendanceModel({
//     required this.id,
//     required this.className,
//     required this.date,
//     required this.studentAttendance,
//   });

//   factory AttendanceModel.fromFirestore(DocumentSnapshot doc) {
//     final data = doc.data() as Map<String, dynamic>;
//     return AttendanceModel(
//       id: doc.id,
//       className: data['className'],
//       date: (data['date'] as Timestamp).toDate(),
//       studentAttendance: Map<String, bool>.from(data['studentAttendance']),
//     );
//   }

//   Map<String, dynamic> toMap() {
//     return {
//       'className': className,
//       'date': Timestamp.fromDate(date),
//       'studentAttendance': studentAttendance,
//     };
//   }
// }







// import 'package:flutter/material.dart';
// import '../models/class.dart';
// import '../models/student.dart';
// import '../services/class_service.dart';
// import '../services/attendance_service.dart';
// import '../services/student_service.dart';

// class AttendanceScreen extends StatefulWidget {
//   @override
//   _AttendanceScreenState createState() => _AttendanceScreenState();
// }

// class _AttendanceScreenState extends State<AttendanceScreen> {
//   final ClassService _classService = ClassService();
//   final StudentService _studentService = StudentService();
//   final AttendanceService _attendanceService = AttendanceService();

//   List<ClassModel> _classes = [];
//   List<StudentModel> _students = [];
//   Map<String, bool> _attendance = {};
//   String? _selectedClassId;  // This will store the ID for selection
//   String? _selectedClassName; // This will store the name for display
//   DateTime _selectedDate = DateTime.now();

//   // Create a map to link ids to names
//   Map<String, String> _idToNameMap = {};

//   @override
//   void initState() {
//     super.initState();
//     _loadClasses();
//   }

//   Future<void> _loadClasses() async {
//     final classes = await _classService.getClasses();
//     setState(() {
//       _classes = classes;
//       _idToNameMap = Map.fromIterable(
//         classes,
//         key: (classModel) => classModel.id,
//         value: (classModel) => classModel.name,
//       );
//     });
//   }

//   Future<void> _loadStudents() async {
//     if (_selectedClassId != null) {
//       final students = await _studentService.getStudents(_selectedClassId!);
//       setState(() {
//         _students = students;
//         _attendance = {for (var student in students) student.id: false};
//       });
//     }
//   }

//   void _submitAttendance() async {
//     if (_selectedClassId != null) {
//       await _attendanceService.submitAttendance(
//         _selectedClassId!,
//         _selectedDate,
//         _attendance,
//       );
//       Navigator.pop(context);
//     }
//   }

//   @override
//   Widget build(BuildContext context) {
//     return Scaffold(
//       appBar: AppBar(
//         title: Text('Take Attendance'),
//       ),
//       body: Padding(
//         padding: const EdgeInsets.all(16.0),
//         child: Column(
//           children: [
//             DropdownButton<String>(
//               value: _selectedClassId,
//               hint: Text('Select Class'),
//               onChanged: (value) {
//                 setState(() {
//                   _selectedClassId = value;
//                   _selectedClassName = _idToNameMap[value!];
//                   _loadStudents();
//                 });
//               },
//               items: _classes.map((classModel) {
//                 return DropdownMenuItem<String>(
//                   value: classModel.id,
//                   child: Text(classModel.name),
//                 );
//               }).toList(),
//             ),
//             TextField(
//               decoration: InputDecoration(labelText: 'Select Date'),
//               readOnly: true,
//               controller: TextEditingController(text: '${_selectedDate.toLocal()}'.split(' ')[0]),
//               onTap: () async {
//                 final date = await showDatePicker(
//                   context: context,
//                   initialDate: _selectedDate,
//                   firstDate: DateTime(2000),
//                   lastDate: DateTime(2101),
//                 );
//                 if (date != null && date != _selectedDate) {
//                   setState(() {
//                     _selectedDate = date;
//                   });
//                 }
//               },
//             ),
//             Expanded(
//               child: ListView(
//                 children: _students.map((student) {
//                   return CheckboxListTile(
//                     title: Text(student.name),
//                     value: _attendance[student.id],
//                     onChanged: (value) {
//                       setState(() {
//                         _attendance[student.id] = value ?? false;
//                       });
//                     },
//                   );
//                 }).toList(),
//               ),
//             ),
//             ElevatedButton(
//               onPressed: _submitAttendance,
//               child: Text('Submit Attendance'),
//             ),
//           ],
//         ),
//       ),
//     );
//   }
// }
